name: "Validate OIDC / AWS secrets present"

on:
  workflow_dispatch:
    inputs:
      check_oidc:
        description: 'Also check OIDC role secret presence'
        required: false
        default: true
        type: boolean

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Check for OIDC role or AWS secrets
        run: |
          echo "Checking repository secrets for OIDC_ROLE_ARN or AWS_ACCESS_KEY_ID..."
          if [ "${{ secrets.OIDC_ROLE_ARN }}" != "" ]; then
            echo "Found OIDC_ROLE_ARN"
            exit 0
          fi
          if [ "${{ secrets.AWS_ACCESS_KEY_ID }}" != "" -a "${{ secrets.AWS_SECRET_ACCESS_KEY }}" != "" ]; then
            echo "Found AWS access key secrets"
            exit 0
          fi
          echo "Neither OIDC_ROLE_ARN nor AWS access key secrets found" >&2
          exit 1
